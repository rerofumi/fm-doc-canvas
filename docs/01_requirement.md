fm-doc-canvas\docs\01_requirement.md
# 要求仕様書 (Phase 1)

## 1. はじめに

本ドキュメントは「fm-doc-canvas」の Phase 1 における要求仕様をまとめたものである。
本アプリは、フリーキャンバス上でテキストノードを配置・連結し、LLM（Large Language Model）を活用して情報の整理や拡張を行うAIメモツールである。

Phase 1 では、基本的なキャンバス操作、テキストメモ機能、およびテキストベースの LLM サポート機能を実装範囲とする。

## 2. システム概要

*   **アプリケーション形態**: ローカル動作のデスクトップアプリケーション
*   **主要技術スタック**:
    *   バックエンド/アプリ基盤: Wails (Go)
    *   フロントエンド: React, Zustand, Tailwind CSS
*   **外部連携**: OpenAI 互換 API (OpenRouter, Ollama 等) を利用した LLM 機能

## 3. 機能要件

### 3.1 キャンバス基本操作

*   **フリーキャンバス**: ユーザーは無限（または十分に広い）キャンバス領域を持つ。
*   **パン操作**: ノードが存在しない背景部分をドラッグすることで、キャンバス全体を移動（パン）できること。
*   **選択解除**: 背景部分をクリックすることで、現在選択されているノードや要素の選択状態を解除できること。

### 3.2 ノード（テキストボックス）機能

*   **ノード表示**:
    *   テキストの内容を表示するボックスとしてキャンバス上に配置される。
    *   長文の場合でもキャンバス上では最大 10行程度で省略表示され、縦に長くなりすぎないようにする。
*   **ノード追加**:
    *   UI上の「追加ボタン」押下により、空のテキストボックスがキャンバスに追加される。
*   **ノード選択**:
    *   クリックにより選択状態になる。
    *   Shiftキー等を用いた複数選択が可能であること（LLMコンテキスト指定用）。
*   **ノード移動**:
    *   ドラッグアンドドロップによりキャンバス上の位置を変更できる。
*   **ノード削除**:
    *   ノードをクリックしてフォーカスし、右クリックでコンテキストメニューを表示する。
    *   コンテキストメニュー内の「削除」を選択することでノードを削除できる。

### 3.3 ライン（コネクション）機能

*   **ノード連結**:
    *   任意の2つのノード間をラインで結ぶことができる。
    *   ラインには方向性があり、始点（Source）から終点（Target）への矢印として表現される。
    *   この連結により、情報の順序や関連性を表現する。
*   **ループ防止**:
    *   ライン作成時に循環参照（ループ）が発生する場合、エラーダイアログを表示し、ラインの作成を拒否する。
*   **ライン削除**:
    *   ラインをクリックしてフォーカスし、右クリックでコンテキストメニューを表示する。
    *   コンテキストメニュー内の「削除」を選択することでラインを削除できる。

### 3.4 詳細編集（ドロワ）機能

*   **編集ドロワ**:
    *   ノードをクリック（選択）すると、画面左側（左ペイン）にドロワ形式のエディタが表示される。
    *   ドロワ内では対象ノードのテキスト全文の閲覧・編集が可能。
*   **自動切り替えと保存**:
    *   ドロワが開いている状態で別のノードをクリックした場合、編集対象が新しいノードに切り替わる。
    *   切り替え時、直前まで編集していた内容は自動的に保存（確定）される。
*   **編集モード**:
    *   **Edit Mode**: プレーンテキストでの編集を行うモード。Markdown記法を記述可能。
    *   **Preview Mode**: Markdownとしてレンダリングされた内容を確認するモード。
*   **サマリー機能**:
    *   各ノードは本文とは別に「100文字程度のサマリー」情報を保持する。
    *   ドロワ下部にサマリーを表示するエリアを設ける。
    *   「サマリー生成ボタン」を配置し、押下時に現在の本文からLLMを用いてサマリーを生成・更新できること。

### 3.5 データ管理

*   **保存/読み込み**:
    *   現在のキャンバス状態（ノードの内容、位置、接続関係、サマリー等）をローカルファイルとして保存・読み込みできる。
    *   ファイル形式は JSON とする。

### 3.6 LLM サポート機能

*   **プロンプト入力**:
    *   画面下部にAIプロンプト入力エリアと実行ボタンを配置する。
*   **新規生成**:
    *   プロンプトを入力して実行すると、LLMにより調査・生成が行われる。
    *   結果（返答）は新しいテキストノードとしてキャンバスに追加される。
    *   生成されたノードには、自動的に生成されたサマリーも埋め込まれる。
*   **コンテキスト利用**:
    *   **単一選択時**: 選択中のノードのテキストをコンテキストとして含め、それに対する指示としてプロンプトを実行できる。
    *   **複数選択時**: 選択された全てのノードをコンテキストに含める。
    *   **順序考慮**: ノードがラインで結ばれている場合、接続順序に従ってコンテキストを結合する。
*   **生成ノードの扱い**:
    *   LLM生成によって追加されたノードは、生成元のノードと自動でリンク（ライン接続）する必要はない（独立したノードとして追加で良い）。

### 3.7 アプリ設定

*   **LLM設定**:
    *   以下の項目を設定画面等で指定できること。
        *   Base URL (OpenAI 互換エンドポイント用)
        *   API Key
        *   Model Name
    *   OpenRouter や Ollama 等の利用を想定。

## 4. UI/UX 要件

### 4.1 画面レイアウト

1.  **メインキャンバスエリア**:
    *   画面中央～右側の大部分を占める。
    *   ノードの配置、ライン接続を行う作業領域。
2.  **左サイドドロワ (Collapsible)**:
    *   ノード詳細編集用。通常は隠れているか、ノード選択時にスライドインする。
    *   Markdownエディタ、プレビュー切り替え、サマリー表示部を含む。
3.  **ボトムエリア**:
    *   AIプロンプト入力バー。
    *   テキスト入力フィールドと送信ボタン。
4.  **ツールバー/メニュー**:
    *   ノード追加ボタン。
    *   ファイル保存/読み込みメニュー。
    *   設定画面へのアクセス。

### 4.2 インタラクション

*   ノードのドラッグ操作はスムーズであること。
*   ライン作成は、ノードの端点などをドラッグして別のノードへドロップする等の直感的な操作であること。
*   Markdownプレビューはリアルタイム、またはタブ切り替え等でストレスなく確認できること。
*   LLM処理中はローディング表示等を行い、処理中であることをユーザーにフィードバックすること。
