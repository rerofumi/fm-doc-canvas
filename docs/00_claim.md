# fm-doc-canvas

フリーキャンバスAIメモツール

## システム構成

- Wails によるローカル動作アプリケーション
- フロントエンドは React + Zustand + Tailwind
- プロジェクトマネージ＆ツールは mise
- リポジトリ管理は jj

## こんなアプリです

### テキストメモ機能基本

- free canvas にノード形式でテキストを置いて、繋げられる形の情報掲載ツール
- テキストボックスのテキストは長い場合端折って 10行くらいで切れた状態で表示される、長文でもcanvas上で縦に長くならない
- テキストボックスはラインで結ぶことができ、テキストの連結、順序を表現できる
- テキストボックスおよびラインの削除は、要素をクリック＆フォーカスして右クリックでコンテキストメニュー表示、コンテキストメニュー内に『削除』があり選択されたらその要素は削除される
- ラインには終点始点があって、向かう先に対しての矢印となっている
- ライン作成時ループになるようであればエラーダイアログを出してラインは作成されない
- テキストボックスをクリックすると左ペインに markdown エディタがドロワ形式で出てきて、そこで全文閲覧＆編集ができる
- ドロワが開いている時に別ノードをクリックしたら、クリックしたノードのテキストに切り替わる(なので切り替わり時に古いノードのテキストは保存されないといけない)
- markdown エディタ内では pure text の edit mode と markdown レンダリングの preview モードがある
- テキストボックス追加ボタンで空のテキストボックスが追加される
- テキストボックスが無い背景部分をドラッグすると全体を移動できる
- ローカルファイルにデータをセーブ/ロードできる、ノードの配置なども保存される、形式は json で良い

### LLM サポート機能

- 画面下部にAIプロンプト入力ボタンがあり、プロンプトを入力するとその内容を LLM 調査して結果(返答を)新しいテキストボックスとして追加する
- LLM で生成したテキストボックスにはリンクを張らなくて良い
- テキストボックスを選択した状態でAIプロンプトを入力すると、選択テキストボックスをコンテキストとしてそのテキストに対するプロンプト指示になる
- 複数テキストボックス選択した場合全てコンテキストとして用いられる、ラインで結ばれていたときコンテキストの順番はそのノード順となる
- 背景クリックで選択状態が解除される
- LLM および画像生成のために OpenAI 互換 API を通じて利用ができる、OpenRouter や Ollama を想定
- アプリの設定として OpenAI 互換の BaseURL, APIkey, ModelName が指定できる
- テキストにはテキスト本文だけで無く、100文字程度のサマリーも情報として持っており、編集ペインには下部にそのサマリー表示とサマリー生成ボタンがある
- LLM の応答で作られたテキストボックスにはそのサマリーが自動で埋め込まれている(サマリーの生成もプロンプト実行のフローに含まれる)

## Phase2 での機能拡張

### 画像ボックス＆生成

- プロンプトボックスにいれたプロンプトで画像生成ができる様にする
- プロンプトボックスのモードに、Text/Image の切り替えトグルスイッチを付ける
- テキストボックスを選択した状態で Image プロンプトを入力すると、選択テキスト群をコンテキストにして、プロンプトを描画指令とした画像生成を行い画像ボックスとして表示する
- 生成した画像は設定にて指定した画像ダウンロードフォルダに保存される、デフォルト値はアプリの実行ファイルとおなじディレクトリにある "Image/"
- 選択に他の画像が含まれていたらその画像も入力コンテキストとして画像生成APIに渡す
- LLM text プロンプト時は一旦画像ボックスは無視される

### ファイルインポート

- エクスプローラーのドラッグアンドドロップで .txt, .md をテキストボックスに、.jpg, .png, .webp を画像ボックスとして canvas に取り込む
- テキストは内部のテキストボックスに保持
- インポート画像は、画像ダウンロードフォルダの下に Import を作成しそこにコピーして利用、デフォルト時は "Image/Import/"

## Phase3 での機能拡張

## エクスポート

- テキストボックス単位での markdown ファイルエクスポート
- 全体からスライド作成

## ビジョン解析

- LLM プロンプト入力時、画像ボックスが含まれていたらマルチモーダル要素としてコンテキストに含める
